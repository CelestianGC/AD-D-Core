<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>

  <windowclass name="encounter" merge="join">
    <script>
      function onDrop(x, y, draginfo)
        if draginfo.isType("shortcut") then
          local sClass, sRecord = draginfo.getShortcutData();
          if (sClass == "encounter") then
            local nodeTarget = getDatabaseNode();
            local bLocked = (DB.getValue(nodeTarget,"locked",0) == 1);
            if not bLocked and Input.isControlPressed() then
              local nodeSource = draginfo.getDatabaseNode();
              local sText = DB.getValue(nodeSource,"text");
              local sCurrentText = DB.getValue(nodeTarget,"text");
              if sText then
                DB.setValue(nodeTarget,"text","formattedtext",sCurrentText .. sText);
              end
            end
          end
        end
      end      
    </script>
  </windowclass>
  
</root>