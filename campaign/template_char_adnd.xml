<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>

	<template name="number_savescore">
		<basicnumber>
			<default>18</default>
			<script file="campaign/scripts/number_savescore.lua" />
		</basicnumber>
	</template>

	<template name="label_savescore">
		<stringfield name="label_save_type">
			<anchored position="right" offset="5,0" width="45" />
 			<multilinespacing>10</multilinespacing>
			<center />
            <readonly />
			<font>arial-regular-6</font>
			<frame name="abilityfields" />
		</stringfield>
	</template>
	
	<template name="number_charasavescore">
		<number_savescore>
			<anchored to="statstitle" position="below" height="30"/>
			<rollable />
			<script>
				function action(draginfo)
                    local nTargetDC = 20;
                    local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
                    local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
                    if sActorType == "pc" then
                        nTargetDC = DB.getValue(nodeActor, "saves." .. self.target[1] .. ".score", 0);
                    end
					ActionSave.performRoll(draginfo, rActor, self.target[1],nTargetDC);
					return true;
				end
				
				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end
					
				function onDoubleClick(x,y)
					return action();
				end
			</script>
            
		</number_savescore>
	</template>
	
	<template name="number_labeled">
		<numberfield>
			<font>sheettext</font>
			<lineoffset default="on">1</lineoffset>
			<script>
				labelwidget = nil;
			
				function onInit()
					if labelres then
						labelwidget = addTextWidget("sheetlabelinline", string.upper(Interface.getString(labelres[1])));
					else
						labelwidget = addTextWidget("sheetlabelinline", string.upper(label[1]));
					end
					if labelwidget then
						local w,h = labelwidget.getSize();
						labelwidget.setPosition("bottomleft", w/2, h/2-4);
					end
				end
			</script>
		</numberfield>
	</template>

	<template name="number_charabilityscore2">
		<number>
 			<anchored to="statstitle" position="insidetopleft"/> 
			<rollable />
            <min>1</min>
            <max>25</max>
			<default>9</default>
			<font>arial-bold-12</font>
			<frame name="abilityscore_box" />
			<script file="campaign/scripts/number_abilityscore.lua" />
		</number>
	</template>
    
	<template name="number_modifier">
		<number>
            <displaysign />
			<center />
            <min>-25</min>
            <max>25</max>
			<default>0</default>
			<hideonvalue>0</hideonvalue>
			<font>arial-regular-7</font>
			<frame name="abilityscore_box" /> 
		</number>
	</template>

   	<template name="label_ability_fields">
		<label_fieldtop>
			<anchored offset="-2,-10" />
			<frame name="abilityfields" />
<!-- 			<frame name="abilityscore" /> -->
		</label_fieldtop>
	</template>

   	<template name="label_mod_fields">
		<label_fieldtop>
			<anchored position="below" offset="-2,-10" />
			<frame name="abilityfields" />
<!-- 			<frame name="abilityscore" /> -->
			<font>arial-regular-6</font>
		</label_fieldtop>
	</template>


	<template name="number_abilitypercent_score">
		<numbercontrol>
			<labelres>char_label_ability_percent</labelres>
			<tooltip textres="char_tooltip_percentile" />
            <min>0</min>
            <max>100</max>
			<anchored position="below" offset="-8,-5" />
			<frame name="abilityscore" />
			<font>sheetlabelmini_percent</font>
			<!-- <center /> -->
			<script>
				function onValueChanged()
					local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
					local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
					local nScore = DB.getValue(nodeActor, "abilities.strength.score", 0);
					AbilityScores.updateStrength(nodeActor,nScore);
				end
			</script>
		</numbercontrol>
	</template>

	<template name="number_abilitypercent_disabled">
		<number>
			<labelres>char_label_ability_percent</labelres>
			<tooltip textres="char_tooltip_percentile" />
			<anchored position="below" offset="-8,-5" />
			<frame name="abilityscorepercent" />
			<font>sheetlabelmini</font>
			<center />
            <min> 0 </min>
            <max> 100 </max>
			<script>
				function onValueChanged()
					local rActor = ActorManager.getActor("pc", window.getDatabaseNode());
					local sActorType, nodeActor = ActorManager.getTypeAndNode(rActor);
					local nScore = DB.getValue(nodeActor, "abilities.strength.score", 0);
					AbilityScores.updateStrength(nodeActor,nScore);
				end
			</script>
		</number>
	</template>

	<template name="number_abilityfield">
			<number>
				<frame name="abilityscore_box" />
<!--                 <backcolor>#ff99cc</backcolor> -->
				<anchored position="right" offset="0,0" width="40"/>
                <displaysign />
   				<center />
                <nokeyedit />
				<font>regular8</font>
			</number>
	</template>

	<template name="percentile_abilityfield">
			<number>
				<frame name="abilityscore_box" />
				<anchored position="right" offset="0,0" width="40"/>
   				<center />
				<font>regular8</font>
			</number>
	</template>
	
	<template name="string_abilityfield">
			<stringfield>
				<frame name="abilityscore_box" />
    <!--             <backcolor>#ff99cc</backcolor> -->
				<!-- <multilinespacing>20</multilinespacing> -->
				<anchored position="right" offset="0,0" width="40" />
   				<center />
                <readonly />
				<font>regular8</font>
			</stringfield>
	</template>
	
	<template name="ability_fields_container">
			<frame_char>
				<anchored position="right" offset="0,0" width="280"/>
				<frame name="bonus_box" />
			</frame_char>			
	</template>
	

</root>
